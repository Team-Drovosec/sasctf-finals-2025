#!/bin/bash

# make sure no xmm instructions are used
gcc -mno-sse -mno-sse2 -mno-sse3 -mno-sse4.1 -mno-sse4.2 -mno-avx -mno-avx2 -nostdlib -static -T ld_script.ld -Wl,-Map=map.txt -o qemu-escape-shellcode.map -Wl,--build-id=none -nostartfiles -fPIC -Os -s qemu-escape-shellcode.c -o qemu-escape-shellcode.elf
objcopy -O binary qemu-escape-shellcode.elf qemu-escape-shellcode.bin
xxd -i qemu-escape-shellcode.bin > qemu-escape-shellcode.h