{-# LANGUAGE ScopedTypeVariables #-}

import Control.Monad.Random.Strict (Rand, StdGen, getRandom, runRand)
import qualified Data.ByteString.Base32 as B32
import Data.ByteString.Builder (toLazyByteString, word64BE)
import qualified Data.ByteString.Lazy as LBS
import Data.Text (Text)
import GHC.Word (Word64)
import System.Random (mkStdGen, newStdGen)

generateRandomOTPSecret :: Rand StdGen Text
generateRandomOTPSecret = do
  a <- getRandom
  b <- getRandom
  let ab = toLazyByteString (word64BE a <> word64BE b)
      secret = B32.encodeBase32Unpadded (LBS.toStrict ab)
  return secret

main :: IO ()
main = do
  let gen = mkStdGen 43
  print gen
  let (result :: Text, gen' :: StdGen) = runRand generateRandomOTPSecret gen
  print result
  print gen'
